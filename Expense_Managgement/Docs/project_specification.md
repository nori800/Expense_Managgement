# 経費精算システム プロジェクト仕様書

## 1. プロジェクト概要

### 1.1 目的

経費精算の効率化を目的とし、社員が領収書の写真を撮影し申請できるWebアプリを開発する。OCRを活用し、手入力の負担を減らし、承認フローを簡素化することで、経理担当者が最終的にCSV形式でデータをエクスポートできるようにする。

### 1.2 ゴール

- 申請から承認、CSV出力までの流れがスムーズに行えるWebアプリを構築。
- OCRを活用し、領収書の金額・日付・店舗名・商品名を自動抽出。
- 申請者・承認者・経理担当の作業負担を軽減。

## 2. システム概要

### 2.1 対象ユーザー

#### 申請者（社内の社員）
- 領収書の写真を撮影し、経費精算を申請する。

#### 承認者（上長・リーダー）
- 申請内容を確認し、承認 or 差し戻しを行う。

#### 経理担当者
- 承認済みのデータをCSVでダウンロードし、会計システムに取り込む。

### 2.2 システム機能概要

- OCR機能：Google Cloud Vision APIを利用し、領収書の情報を自動抽出。
- 画像補正：Sharp + Jimp による傾き補正・明るさ調整・ノイズ除去。
- データ編集：OCRの結果をフォームに自動入力し、手動修正が可能。
- 承認フロー：承認者が申請を確認し、承認または差し戻しを実施。
- CSVエクスポート：管理者（経理担当者）のみがCSVをダウンロード可能。

## 3. ワークフロー

### 3.1 申請フロー

1. 申請者がスマホまたはPCで領収書をアップロード。
2. Google Cloud Vision API でOCR処理を実施。
3. 自動抽出されたデータを申請フォームに反映。
4. 申請者が手動修正し、承認者へ送信。
5. 承認者が内容を確認し、承認または差し戻しを実施。
6. 承認済みデータを経理担当が確認し、CSVダウンロード。

### 3.2 承認フロー

- 承認者は基本1名。ただし、将来的に複数承認の拡張が可能な設計。
- 承認時、コメント入力が可能。
- 差し戻し時、理由を明記して申請者へ返却。

## 4. 機能要件

### 4.1 フロントエンド（React）

- ユーザー認証（メール + パスワード）
- 画像アップロード（Supabaseストレージ）
- OCR結果のリアルタイム表示
- フォームでの手動修正機能
- 申請・承認・差し戻しのワークフロー
- CSVエクスポート（管理者のみ）

### 4.2 バックエンド（Node.js + Supabase）

- Supabase ストレージに画像保存
- Google Cloud Vision API との連携
- 画像補正（Sharp + Jimp）
- OCR結果のデータ変換とDB保存
- 承認フローの管理
- CSVエクスポート機能

## 5. 非機能要件

- レスポンシブ対応（スマホ・PCどちらでも利用可能）
- セキュリティ（認証・アクセス権限管理）
- ログ管理（申請・承認履歴の記録）
- パフォーマンス（OCR処理を高速化し、ユーザー体験を向上）

## 6. データモデル

### 6.1 Supabase データベース構成

| 項目 | 説明 |
|------|------|
| id | ユニークID |
| 申請者ID | 誰が申請したか |
| 日付 | 領収書の日付 |
| 金額 | 使用金額 |
| 費目（カテゴリ） | 交通費・食事・宿泊・備品など |
| 店舗名 | 支払いを行ったお店の名前 |
| 商品名 | OCRで取得 or 手動入力 |
| 承認者ID | 誰が承認したか |
| ステータス | 申請中 / 承認済 / 差し戻し |
| コメント | 差し戻し理由や補足情報 |
| 領収書画像URL | Supabase ストレージの画像URL |

## 7. 成功基準（KPI）

- OCRの精度 80%以上（手動修正を最小限に）
- 申請から承認まで 5分以内
- 月間 500件の申請処理が可能
- CSVエクスポートのデータ整合性 100%

## 8. 今後の拡張性

- 多段階承認フロー（課長 → 部長 → 経理 など）
- 他のOCR API（AWS Textract など）との比較テスト
- 会計システムとのAPI連携（freee / マネーフォワード など）
- モバイルアプリ化（PWA対応） 